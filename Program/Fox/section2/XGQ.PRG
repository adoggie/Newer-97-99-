CLEAR ALL
CLEAR
SET TALK OFF
SET DELETED ON
SET SAFETY OFF
SET EXACT ON
SET ANSI ON
SET CARRY OFF
SET AUTOSAVE ON
SET CENTURY ON
SET SYSMENU TO 
DEFINE WINDOW RM FROM 0.000,0.000 TO 35.000,100.000;
TITLE "维他奶(上海)有限公司薪金处理";
FONT "宋体",12;
CLOSE;
DOUBLE;
FLOAT;
GROW;
COLOR SCHEME(3)

activate window rm&&windows 关闭按纽（右上）

DEFINE PAD PA1 OF _MSYSMENU PROMPT "口令修改" COLOR SCHEME 3 
DEFINE PAD SP1 OF _MSYSMENU PROMPT "\    " SKIP

DEFINE PAD PA2 OF _MSYSMENU PROMPT "工资输入" COLOR SCHEME 3
DEFINE PAD SP2 OF _MSYSMENU PROMPT "\    " SKIP

DEFINE PAD PA3 OF _MSYSMENU PROMPT "工资计算" COLOR SCHEME 3
DEFINE PAD SP3 OF _MSYSMENU PROMPT "\    " SKIP

DEFINE PAD PA4 OF _MSYSMENU PROMPT "工资打印"
DEFINE PAD SP4 OF _MSYSMENU PROMPT "\    " SKIP

DEFINE PAD PA5 OF _MSYSMENU PROMPT "退出" COLOR SCHEME 3

ON SELECTION PAD PA1 OF _MSYSMENU;
 DO PASSWO IN LOCFILE("XGQ.PRG")
ON SELECTION PAD PA3 OF _MSYSMENU; 
 DO CAC IN LOCFILE("XGQ.PRG")
ON SELECTION PAD PA4 OF _MSYSMENU;
 DO ALLPR IN LOCFILE("XGQ.PRG")
ON SELECTION PAD PA5 OF _MSYSMENU;
 DO EXITT IN LOCFILE("XGQ.PRG")

ON PAD PA2 OF _MSYSMENU ACTIVATE POPUP PP2&&有菜单
DEFINE POPUP PP2 MARGIN COLOR SCHEME 4
DEFINE BAR 1 OF PP2 PROMPT "全部输入"
DEFINE BAR 2 OF PP2 PROMPT "个人输入"
ON SELECTION BAR 1 OF PP2 DO ALLACC IN LOCFILE("XGQ.PRG")
ON SELECTION BAR 2 OF PP2 DO PRSACC IN LOCFILE("XGQ.PRG")

PROCEDURE EXITT
CLOSE ALL
SET SYSMENU TO DEFAULT
RETURN


PROCEDURE PASSWO
*"口令修改"
STORE " " TO WO
STORE 0 TO FILE,CH
STORE 2 TO PAI
STORE SPACE(8) TO PASSWORD,PASSWOR1
DO WHILE  PAI < 3
   @ 10,5 SAY "请输入新口令:" FONT "宋体",12 
   PASSWORD=PASSINPU(10,18)   
   PAI=LEN(PASSWORD)
   IF PAI< 3 
     STORE SPACE(8) TO PASSWORD
     @ 11,5 SAY "密码长度不能短于三位,请重新输入,击RETURN键:" FONT "宋体",12
     @ ROW(),COL() GET PASSWORD
     READ
     CLEAR
     LOOP
   ENDI
ENDD
@  11,5 SAY "请再次输入新口令,以便核对:" FONT "宋体",12 
 PASSWOR1=PASSINPU(ROW(),COL())
IF PASSWORD<>PASSWOR1
    STORE SPACE(8) TO PASSWORD
    @ 12,5 SAY "口令核对出错,口令修改失败,击RETURN键退出:"  FONT "宋体",12
    @ ROW(),COL() GET PASSWORD
    READ
 ELSE
     FILE=FCREATE("~PA.PA",2)
     =FCLOSE(FILE)
     FILE=FOPEN("~PA.PA",2)
     PAI=LEN(PASSWORD)
     STORE  TRIM(STR(PAI+27)) TO PASSWOR1
     =FPUTS(FILE,PASSWOR1)
     PAI=LEN(PASSWORD)
     DO WHILE PAI<>0 
        WO=SUBSTR(PASSWORD,PAI,1)
        WO=CHR(ASC(WO)+60)
        =FPUTS(FILE,WO)
        PAI=PAI-1
      ENDDO
      =FCLOSE(FILE)
    ENDI
CLEAR
RETURN

FUNCTION PASSINPU
 PARAMETER RO,CO
STORE  SPACE(8)  TO  PASSW
STORE 0 TO WO1,I
DO WHILE WO1 <> 13
*@ ROW()+1,COL() SAY ""
 WO1=INKEY(0)
 IF WO1=13 
  LOOP
 ENDI
* IF WO1=08 OR WO1=127
*  IF I<=0
*   @ 
 IF I< 8 AND I>=0
  PASSW=TRIM(PASSW)+CHR(WO1)
  @ RO,CO SAY "*"
  CO=CO+1
  I=I+1
 ELSE 
  ENDI
ENDD
RETURN PASSW

PROCEDURE ALLACC
*GZ ALL INPUT
STORE 1 TO I,SWO
STORE SPACE(6) TO CODE1,CODE
SELE 2
USE EMPLOYEE 
INDEX ON EMP_CODE TO EMPLOYEE
*SET ORDER 1
SELE 1
USE VT_GZ
INDEX ON EMP_CODE TO VT_GZ
*SET RELATION TO EMP_CODE INTO B
STORE DATE() TO DATE1
@ 11,22 SAY "请输入日期:" FONT "宋体",12
@ ROW(),COL() GET DATE1
READ
@ 0,0 CLEAR
SELE 2
GO TOP
ACTIVATE WINDOW RM
*MOVE WINDOW RM CENTER
DO WHILE CODE1<>"EXIT"
 SELE 2
 STORE EMPLOYEE.EMP_CODE TO CODE1
 SELE 1
 SEEK CODE1
  IF EOF(1)
   IF LEN(TRIM(DTOS(EMPLOYEE.QUIT_DA)))=0
    APPEND BLANK
    REPL VT_GZ.EMP_CODE WITH EMPLOYEE.EMP_CODE
    REPL VT_GZ.EMP_DEP WITH EMPLOYEE.EMP_DEP
    REPL VT_GZ.QGBZ WITH .T.
    REPL VT_GZ.PAY_DATE WITH DATE1
   ELSE
     SELE 2
     SKIP 1
*    IF EOF(2)
*     @ 20,0 SAY "已是最后一个记录"
*     FOR I = 1 TO 10000
*      STORE SPACE(6) TO CODE1
*     ENDFOR
*     @ 20,0 SAY "                 "
*     SKIP -1
*    ENDI
   ENDI
  ENDI
  STORE 1 TO CHOICE
  =SCRINP()
  @ 18,0 GET CHOICE FUNCTION "*TH 确定;删除;查上一个记录;查下一个记录;结束" SIZE 1.5,2
READ
SELE 1
DO CASE
   CASE CHOICE=1 
     SELE 2
     SKIP 1
    IF EOF(2)
     @ 19,0 SAY "已是最后一个记录"
     FOR I = 1 TO 10000
      STORE SPACE(6) TO CODE1
     ENDFOR
   
     SKIP -1
    ENDI
   CASE CHOICE=2
    @ 20 ,0 SAY "删除此纪录" COLOR RGB(0,0,0,,,,)
    @ ROW(),COL() GET SWO FUNCTION "*TH YES;NO"
    READ
    @ 20,0 CLEAR
   IF SWO = 1
     SELE 1
     DELETE
     PACK
     REINDEX
*     SELE 2
*     SKIP 1
*     IF EOF(2)
*      SKIP -1     
*     ENDI
   ENDI
   CASE CHOICE=3
    IF .NOT. BOF(2)
     SELE 2
     SKIP -1
    ENDI
   CASE CHOICE=4 
     SELE 2
     SKIP 1
    IF EOF(2)
     @ 19,0 SAY "已是最后一个记录"
     FOR I = 1 TO 10000
      STORE SPACE(6) TO CODE1
     ENDFOR
     @ 19,0 SAY "                 "
     SKIP -1 
    ENDI
   CASE CHOICE=5
    STORE "EXIT" TO CODE1
 ENDCASE    
*@ 0,0 CLEAR
ENDDO
CLOSE ALL
DEACTIVATE WINDOW RM
RETURN

PROCEDURE PRSACC
*GZ PRS INPUT
DIMENSION A[400]

STORE SPACE(20) TO A
STORE 0 TO I,J,CHOI1,CHOI2,CHOI3,CHOICE
STORE SPACE(6) TO CODE
STORE SPACE(10) TO WNAME
STORE SPACE(6) TO CODE1

SELE 2
USE EMPLOYEE
INDEX ON EMP_CODE TO EMPLOYEE
SELE 1
USE VT_GZ
INDEX ON EMP_CODE TO VT_GZ
*SET RELA TO EMP_CODE INTO EMPLOYEE

@ 0,0 CLEA

STORE DATE() TO DATE1
@ 11,22 SAY "请输入日期:" FONT "宋体",12 
@ ROW(),COL() GET DATE1
READ

@ 0,0 CLEAR
ACTIVATE WINDOW RM1

  STORE SPACE(6) TO CODE1
  STORE 0 TO I
  GOTO TOP
  DO WHILE .NOT. EOF(2)
    I=I+1 
    STORE EMPLOYEE.EMP_CODE TO CODE
    STORE EMPLOYEE.EMP_NAME TO WNAME
    SELECT 1
    SEEK CODE
    IF (.NOT. EOF(1) AND LEN(TRIM(DTOS(EMPLOYEE.QUIT_DA)))=0) OR (EOF(1) AND LEN(TRIM(DTOS(EMPLOYEE.QUIT_DA)))=0)
      A[I]=CODE+SPACE(4)+WNAME
    ELSE
      I=I-1
    ENDIF
    SELECT 2
    SKIP 1
   ENDDO  
  STORE 0 TO CHOI2
DO WHILE CHOI2 <>1
 
  STORE 1 TO CHOI1
******
  @ 2,17 SAY "全体员工" FONT "宋体",12 COLOR RGB(0,0,0,,,,)
  @ 3,17 GET CHOI1 FROM A FONT "宋体",12 RANGE 1,I FUNCTION "&T" DEFAULT CHOI1 SIZE 15,20 VALID MACH()
******
 
  @ 20,17 GET CHOI2 FUNCTION "*TH 结束输入" SIZE 1.5,5
  READ

  IF CHOI2=1
   EXIT
  ENDI
ENDDO

DEACTIVATE WINDOW RM1
CLOSE ALL
RETURN

FUNCTION MACH

 STORE LEFT(A[CHOI1],6) TO CODE
 STORE RIGHT(A[CHOI1],10) TO WNAME
  SELE 2
  SEEK CODE
  SELE 1
  SEEK CODE
  IF EOF(1)
   IF LEN(TRIM(DTOS(EMPLOYEE.QUIT_DA)))=0
    APPEND BLANK
    REPL VT_GZ.EMP_CODE WITH EMPLOYEE.EMP_CODE
    REPL VT_GZ.EMP_DEP WITH EMPLOYEE.EMP_DEP
    REPL VT_GZ.QGBZ WITH .T.
    REPL VT_GZ.PAY_DATE WITH DATE1
   ENDI
  ENDI   
  =SCRINP()
  @ 18,10 GET CHOICE FUNCTION "*TH 确定;删除" SIZE 1.5,2
  READ
  DO CASE
   CASE CHOICE=1 
      
   CASE CHOICE=2
    @ 19 ,10 SAY "删除此纪录" COLOR RGB(0,0,0,,,,)
    @ ROW(),COL() GET CHOI3 FUNCTION "*TH YES;NO"
    READ
    @ 19,10 SAY "               " 
   IF CHOI3 = 1
     DELETE
     PACK
     REINDEX
   ENDI
  ENDCASE
 @ 0,0 CLEAR TO 22,76
 RETURN
 
FUNCTION SCRINP
*GZSCREEN INPUT
STORE 0 TO RO,CO
REPL VT_GZ.PAY_DATE WITH DATE1
*@ 1,0 SAY "编号:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO 
 =FORMA(ROW(),COL(),ROW()+1,COL()+6.4) 
@ RO,CO SAY EMPLOYEE.EMP_CODE COLOR SCHEME(2) 
@ 1,60 SAY "姓名:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1,COL()+10.4)
  
@ RO,CO SAY EMPLOYEE.EMP_NAME COLOR SCHEME(2)
@ 3,0 SAY "部门号:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1,COL()+3.4)
@ RO,CO SAY EMPLOYEE.EMP_DEP COLOR SCHEME(2)
@ 3,30 SAY "部门:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1,COL()+16.4)
@ RO,CO SAY EMPLOYEE.EMP_DEPNM COLOR SCHEME(2)
@ 3,60 SAY "日期:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1,COL()+10.4)
@ RO,CO SAY VT_GZ.PAY_DATE COLOR SCHEME(2)
@ 5,0 SAY "一般加班:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1.1,COL()+8.4)
@ RO,CO GET VT_GZ.YBJB COLOR SCHEME(2)
@ 5,30 SAY "假日加班:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1.1,COL()+8.4)
@ RO,CO GET VT_GZ.JRJB COLOR SCHEME(2)
@ 5,60 SAY "夜班:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1.1,COL()+2.4)
@ RO,CO GET VT_GZ.YB COLOR  SCHEME(2)
@ 7,0 SAY "法定加班:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1.1,COL()+8.4)
@ RO,CO GET VT_GZ.FDJB COLOR  SCHEME(2)
@ 9,0 SAY "有勤工奖?(T/F):" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1.1,COL()+1.4)
@ RO,CO GET VT_GZ.QGBZ COLOR  SCHEME(2)
@ 9,30 SAY "缺勤天数:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1.1,COL()+4.4)
@ RO,CO GET VT_GZ.QQT COLOR  SCHEME(2)
@ 9,60 SAY "迟到天数:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1.1,COL()+2.4)
@ RO,CO GET VT_GZ.QG01 COLOR  SCHEME(2)
@ 11,0 SAY "早退天数:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1.1,COL()+2.4)
@ RO,CO GET VT_GZ.QG06 COLOR  SCHEME(2)
@ 11,30 SAY "有薪病假:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1.1,COL()+4.4)
@ RO,CO GET VT_GZ.QG02 COLOR  SCHEME(2)
@ 11,60 SAY "无薪病假:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1.1,COL()+4.4)
@ RO,CO GET VT_GZ.QG03 COLOR  SCHEME(2)
@ 13,0 SAY "事假天数:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1.1,COL()+4.4)
@ RO,CO GET VT_GZ.QG04 COLOR SCHEME(2)
@ 13,30 SAY "旷工天数:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1.1,COL()+2.4)
@ RO,CO GET VT_GZ.QG05 COLOR SCHEME(2)
@ 13,60 SAY "工伤:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1.1,COL()+6.4)
@ RO,CO GET VT_GZ.GS COLOR SCHEME(2)
@ 15,0 SAY "膳食费:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1.1,COL()+8.4)
@ RO,CO GET VT_GZ.MEAL COLOR SCHEME(2)
@ 15,30 SAY "其它:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1.1,COL()+7.4)
@ RO,CO GET VT_GZ.QT COLOR SCHEME(2)
@ 15,60 SAY "住宿:" COLOR RGB(0,0,0,,,,)
STORE ROW()+.1 TO RO
STORE COL()+.2 TO CO
 =FORMA(ROW(),COL(),ROW()+1.1,COL()+2.4)
@ RO,CO GET VT_GZ.ZS COLOR SCHEME(2)
*DEACTIVATE WINDOW RM    
RETURN

FUNCTION FORMA &&
 PARAMETER RO1,CO1,RO2,CO2
 @ RO1,CO1 TO RO1,CO2;
   PEN 1,8;
   STYLE "1";
   COLOR RGB(0,0,0,0,0,0)

 @ RO1,CO2 TO RO2,CO2;
   PEN 1,8;
   STYLE "1";
   COLOR RGB(255,255,255,255,255,255)

 @ RO2,CO1 TO RO2,CO2;
   PEN 1,8;
   STYLE "1";
   COLOR RGB(255,255,255,255,255,255)  

 @ RO1,CO1 TO RO2,CO1;
   PEN 1,8;
   STYLE "1";
   COLOR RGB(0,0,0,0,0,0)
RETURN &&

PROCEDURE ALLPR
*GZ ALL PRINT
*PUBLIC 

DIMENSION A[400],B[400]
*PUBLIC I,J,CHOI1,CHOI2
DEFINE WINDOW PRV FROM 0.000,0.000 TO 38.000,80.000;
TITLE "维他奶(上海)有限公司打印处理";
FONT "宋体",12;
CLOSE;
DOUBLE;
FLOAT;
GROW

*COLOR SCHEME(3) 

STORE SPACE(20) TO A,B
STORE 0 TO I,J,CHOI1,CHOI2,CHOI3,II
STORE SPACE(6) TO CODE
STORE SPACE(10) TO WNAME

SELECT 1
USE VT_GZ
INDEX ON EMP_CODE TO VT_GZ
SELECT 2
USE EMPLOYEE
INDEX ON EMP_CODE TO EMPLOYEE
STORE 0 TO I
GOTO TOP
DO WHILE .NOT. EOF(2)
 I=I+1 
  STORE EMP_CODE TO CODE
  STORE EMP_NAME TO WNAME
  SELECT 1
  SEEK CODE
 IF .NOT. EOF(1) AND LEN(TRIM(DTOS(EMPLOYEE.QUIT_DA)))=0
   A[I]=CODE+SPACE(4)+WNAME
 ELSE
  I=I-1
 ENDIF
SELECT 2
SKIP 1
ENDDO

ACTIVATE WINDOW PRV
STORE 1 TO CHOI1,CHOI2
STORE 0 TO J
DO WHILE CHOI3 =1 OR CHOI3 = 2 OR CHOI3 = 0
 STORE 1 TO CHOI3
 @ 2,5 SAY "全体员工" FONT "宋体",12 COLOR RGB(0,0,0,,,,)
 @ 3,5 GET CHOI1;
  FROM A;
  FONT "宋体",12;
  RANGE 1,I;
  FUNCTION "&T";
  DEFAULT CHOI1;
  SIZE 15,20;
  VALID MOAR()
  
  @ 3,50 SAY "选择的员工" FONT "宋体",12 COLOR RGB(0,0,0,,,,)

  @ 4,50 GET CHOI2;
  FROM B;
  FONT "宋体",12;
  RANGE 1,J;
  FUNCTION "&T";
  DEFAULT CHOI2;
  SIZE 14,22;
  VALID MOAD()  

 @ 4,35 GET CHOI3 FUNCTION "*TV 全选;全移;确定;放弃";
   SIZE 1.5,4,2;
   FONT "宋体",12
 READ
DO CASE
 CASE CHOI3=1
   FOR II=1 TO I
    J=J+1
    B[J]=A[II]
   ENDFOR
  STORE 0 TO I
  STORE SPACE(20) TO A
 CASE CHOI3=2
  FOR II=1 TO J
   I=I+1
   A[I]=B[II]
  ENDFOR
  STORE 0 TO J
  STORE SPACE(20) TO B
ENDCASE
ENDD
IF CHOI3=3
SELE 3
USE TEMP
ZAP
 FOR I=1 TO J
  STORE LEFT(B[I],6) TO CODE
  STORE RIGHT(B[I],10) TO WNAME
  SELE 1
  SEEK CODE
  SELE 3
  APPEND BLANK
  REPLACE TEMP.EMP_CODE WITH VT_GZ.EMP_CODE
  REPLACE TEMP.EMP_DEP WITH VT_GZ.EMP_DEP
  REPLACE TEMP.EMP_NAME WITH WNAME
  REPLACE TEMP.JB WITH VT_GZ.JB
  REPLACE TEMP.BABZ WITH VT_GZ.BABZ
  REPLACE TEMP.QQT WITH VT_GZ.QQT
  REPLACE TEMP.JRJB WITH VT_GZ.JRJB
  REPLACE TEMP.YBJB WITH VT_GZ.YBJB
  REPLACE TEMP.FDJB WITH VT_GZ.FDJB
  REPLACE TEMP.QGBZ WITH VT_GZ.QGBZ
  REPLACE TEMP.QG01 WITH VT_GZ.QG01
  REPLACE TEMP.QG02 WITH VT_GZ.QG02
  REPLACE TEMP.QG03 WITH VT_GZ.QG03
  REPLACE TEMP.QG04 WITH VT_GZ.QG04
  REPLACE TEMP.QG05 WITH VT_GZ.QG05
  REPLACE TEMP.QG06 WITH VT_GZ.QG06
  REPLACE TEMP.GS WITH VT_GZ.GS
  REPLACE TEMP.ZS WITH VT_GZ.ZS
  REPLACE TEMP.QT WITH VT_GZ.QT
  REPLACE TEMP.B_SALARY WITH VT_GZ.B_SALARY
  REPLACE TEMP.A_BONW WITH VT_GZ.A_BONW 
  REPLACE TEMP.OT WITH VT_GZ.OT
  REPLACE TEMP.YB WITH VT_GZ.YB
  REPLACE TEMP.OTHERS WITH VT_GZ.OTHERS
  REPLACE TEMP.ACCOM WITH VT_GZ.ACCOM
  REPLACE TEMP.HYGIENE WITH VT_GZ.HYGIENE 
  REPLACE TEMP.TOTAL WITH VT_GZ.TOTAL
  REPLACE TEMP.PAY_DATE WITH VT_GZ.PAY_DATE
  REPLACE TEMP.SUPERVISOR WITH VT_GZ.SUPERVISOR
  REPLACE TEMP.TAX WITH VT_GZ.TAX
  REPLACE TEMP.TTOTAL WITH VT_GZ.TTOTAL
  REPLACE TEMP.HEADCOUNT WITH VT_GZ.HEADCOUNT
  REPLACE TEMP.MEAL WITH VT_GZ.MEAL
  REPLACE TEMP.COMM WITH VT_GZ.COMM
  REPLACE TEMP.INSU WITH VT_GZ.INSU 
  REPLACE TEMP.MANAGER WITH VT_GZ.MANAGER
  REPLACE TEMP.YBALLOW WITH VT_GZ.YBALLOW 
  REPLACE TEMP.B_ALLOW WITH VT_GZ.B_ALLOW
  REPLACE TEMP.PRE_MTH WITH VT_GZ.PRE_MTH
  REPLACE TEMP.OTHER_DED WITH VT_GZ.OTHER_DED 
  REPLACE TEMP.OTHER_ALL WITH VT_GZ.OTHER_ALL 
  REPLACE TEMP.TMP WITH VT_GZ.TMP 
 ENDFOR
 SELE 3
 REPORT FORM TEMP TO PRINTER
ENDIF
DEACTIVATE WINDOW PRV
CLOSE ALL
RETURN

FUNCTION MOAR
* PARAMETER MA,MB,MI,MJ,MS
 STORE 0 TO P,CHOI3
 J=J+1
 B[J]=A[CHOI1]
 FOR P=CHOI1 TO I-1
  A[P]=A[P+1]
 ENDFOR
 I=I-1
RETURN
 
FUNCTION MOAD
 STORE 0 TO P,CHOI3
 I=I+1
 A[I]=B[CHOI2]
 FOR P=CHOI2 TO J-1
  B[P]=B[P+1]
 ENDFOR
 J=J-1
RETURN 
 

PROCEDURE CAC
*工资计算
SET SAFETY OFF
STORE 0 TO MBASIC
CLOSE ALL
SELE 1
USE VT_GZ
INDE ON EMP_CODE TO VT_GZ
SELE 2
USE EMPLOYEE
INDEX ON EMP_CODE TO EMPLOYEE
STORE DATE() TO DATE1
@ 10,10 SAY "请输入日期:" FONT "宋体",12
@ ROW(),COL() GET DATE1
READ
CLEAR
SELE 1
WORKDAY=20
REPL ALL HYGIENE WITH 0
SET RELA TO VT_GZ.EMP_CODE INTO EMPLOYEE
GO TOP
DO WHILE .NOT. EOF()
  MCODE=VT_GZ.EMP_CODE
  SELE 2
  SEEK MCODE
  MBASIC=EMPLOYEE.BASIC_SALA
  SELE 1
  DAY_RATE=8*12/52/40
  IF WORKDAY-QQT>=5
    REPL B_SALARY WITH MBASIC-((QQT+QG03+QG04)*DAY_RATE*MBASIC)
  ELSE
    REPL B_SALARY WITH (WORKDAY-(QQT+QG03+QG04))*DAY_RATE*MBASIC
  ENDIF
  REPL OT WITH (JRJB*MBASIC*DAY_RATE/8)*2.0+(YBJB*MBASIC*DAY_RATE/8)*15;
  +(FDJB*MBASIC*DAY_RATE/8)*3.0
  REPL YBALLOW WITH YB*3
  REPL B_ALLOW WITH (B->ALLOW-((QQT+QG03+QG04)*DAY_RATE*B->ALLOW))
  REPL OTHER_DED WITH QT
  MA_BONW=(QG01+QG06)*33.3+QG02*40+QG03*66.7+QG04*100+QG05*200+GS*8
  IF CMONTH(B->ENTRY_DA)=CMONTH(A->PAY_DATE) .AND. DAY(B->ENTRY_DA);
  <>1 .AND. YEAR(B->ENTRY_DA)=YEAR(A->PAY_DATE)
    M150=B->ATT_BONUS-(B->ATT_BONUS/WORKDAY*(QQT+QG02+QG03+QG04+QG05+GS))
  ELSE
    M150=B->ATT_BONUS
  ENDI
  IF MA_BONW<M150 .AND. B->ATT_BONUS<>0
    REPL A_BONW WITH M150-MA_BONW
  ELSE
    REPL A_BONW WITH 0
  ENDI
  IF .NOT. EMPTY(B->ACCOM_DA) .AND. EMPTY(B->QUIT_DA)
    IF B->SUPERVISOR
      REPL A->ACCOM WITH -30
    ELSE
      REPL A->ACCOM WITH 0 
    ENDI
    IF CMONTH(B->ACCOM_DA)=CMONTH(A->PAY_DATE) .AND. DAY(B->ACCOM_DA)>15;
    .AND. YEAR(B->ACCOM_DA)=YEAR(A->PAY_DATE)
      REPL A->ACCOM WITH 0
    ENDI
  ENDI
  SELE 1
  SKIP 1
 ENDDO
REPL ALL TOTAL WITH B_SALARY+B_ALLOW+A_BONW+OT+YBALLOW+COMM+PRE_MTH+;
OTHER_ALL+INSU+ACCOM+MEAL+OTHER_DED
SET FILT TO
CLOSE ALL
RETURN
